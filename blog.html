<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blog - Meu Site</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="/">Meu Site</a>
      <nav class="nav">
        <a href="/">In√≠cio</a>
        <a href="/blog.html">Blog</a>
        <a href="/forum.html">F√≥rum</a>
      </nav>
      <div class="actions">
        <button id="theme-toggle" aria-label="Alternar tema">üåì</button>
      </div>
    </div>
  </header>

  <main class="container">
    <h1>Blog</h1>
    <p class="lead">Posts criados/gerenciados com Netlify CMS e salvos no GitHub (pasta <code>/posts</code>).</p>

    <section id="posts-list" class="posts-grid">
      <!-- Posts ser√£o carregados aqui -->
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>Feito com ‚ù§Ô∏è ‚Äî DSM Fatec</p>
    </div>
  </footer>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
/*
  script to load posts based on posts/list.json.
  Netlify CMS will create markdown files in /posts.
  For listing to work dynamically, update /posts/list.json with filenames when adding posts,
  or edit this logic to include known filenames.
*/
async function loadPosts(){
  try{
    const listResp = await fetch('posts/list.json');
    if(!listResp.ok) throw new Error('N√£o encontrou posts/list.json');
    const list = await listResp.json();

    const container = document.getElementById('posts-list');
    container.innerHTML = '';

    // fetch each markdown and render an excerpt card
    await Promise.all(list.map(async (p) => {
      try{
        const mdResp = await fetch('posts/' + p.file);
        if(!mdResp.ok) return;
        const md = await mdResp.text();
        // parse frontmatter
        const fmMatch = md.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);
        let meta = {}, body = md;
        if(fmMatch){
          const rawMeta = fmMatch[1];
          body = fmMatch[2];
          rawMeta.split(/\n+/).forEach(line => {
            const [k,...rest]=line.split(':');
            if(!k) return;
            meta[k.trim()] = rest.join(':').trim().replace(/^"|"$/g,'');
          });
        }
        const excerpt = body.split('\n').slice(0,3).join(' ');
        const card = document.createElement('article');
        card.className = 'post-card';
        card.innerHTML = `
          <h3>${meta.title || p.title || 'Sem t√≠tulo'}</h3>
          <time>${meta.date || ''}</time>
          <p>${marked.parseInline(excerpt)}</p>
          <a class="read-more" href="posts/${p.file.replace('.md','.html')}">Ler post</a>
        `;
        container.appendChild(card);
      }catch(e){
        console.error(e);
      }
    }));
  }catch(e){
    console.error(e);
    document.getElementById('posts-list').innerHTML = '<p>N√£o foi poss√≠vel carregar a lista de posts. Verifique <code>/posts/list.json</code>.</p>';
  }
}
loadPosts();
</script>
<script src="script.js"></script>
</body>
</html>
